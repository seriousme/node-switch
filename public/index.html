<!DOCTYPE html>
<html >
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1"> 
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link href="pics/serious-logo.png" rel="apple-touch-icon" />
  
  <title>Home Switch</title>
   <link href="ionic/css/ionic.css" rel="stylesheet">
  <style>
  @media (min-width: 520px) {
  .ct {
    width: 520px;
	margin-left: auto ;
	margin-right: auto ;
  }
}
  .buttongroup {
	float: right;
  }
  .padding {
   margin-top: 40px;
  }
  
  </style>
  <script type='text/javascript'>//<![CDATA[ 
window.onload = function(){
var busy=false;

function showError(err){
	var el = document.getElementById('ftr');
	el.innerHTML = err;
}

function getJSON(url,handler,errHandler){
	var xhr=new XMLHttpRequest();
	xhr.responseType="json";
	xhr.onreadystatechange=function(){
		if (xhr.readyState==4){
				if ( xhr.response){
					handler(xhr.response);
					}
				else{
					errHandler(Error(xhr.statusText));
				}
		}
	}
	xhr.open("GET",url,true);
	xhr.send();
}

function setState(serviceResponse) {
	for (var item in serviceResponse){
		var val = ( serviceResponse[item] === 'on');
		var el = document.getElementById(item);
		if (el){
			var cv = el.checked;
			if (cv != val) {
				busy=true;
				el.click();
				busy=false;
			}
		}
	}
}

function callService(id, value) {
    var serviceUrl = '/cgi-bin/switch';
    var url = serviceUrl + '?sid='+Math.random();
	if (value){
	    if (id != "auto"){
			id = "device" + id;
		}
		url = url + '&' + id + '=' + value;
	}
    //showError(url);
	getJSON(url, setState, showError );
}


callService();

var inputs = document.getElementsByTagName("input");
for (var i=0; i < inputs.length; i++){
	var inp = inputs[i];
	inp.onchange=function(){ 
		if (! busy){
			callService(this.getAttribute('data-device'), this.checked ? "on" : "off");
		}
	};
}
var buttons = document.getElementsByTagName("button");
for (var j=0; j < buttons.length; j++){
	var bt = buttons[j];
	bt.onclick = function(){ 
		if (! busy){
			callService(this.getAttribute('data-device'), this.getAttribute('data-value'));
		}
	};
}
};//]]>  

</script>


</head>
<body>
  <div class="ct bar bar-header bar-positive">
    <h1 class="title">
      Home Switch
    </h1>
  </div>
  
  <div class="ct ion-content has-header has-footer">
	<div class="padding">
    <ul class="list">
      <li class="item item-toggle">
        Light 1
        <label class="toggle toggle-positive">
          <input type="checkbox" id="device1" data-device="1">
          <div class="track">
            <div class="handle">
            </div>
          </div>
        </label>
      </li>
      <li class="item item-toggle">
        Light 2
        <label class="toggle toggle-positive">
          <input type="checkbox" id="device2" data-device="2">
          <div class="track">
            <div class="handle">
            </div>
          </div>
        </label>
      </li>
      <li class="item item-toggle">
        Light 3
        <label class="toggle toggle-positive">
          <input type="checkbox" id="device3" data-device="3">
          <div class="track">
            <div class="handle">
            </div>
          </div>
        </label>
      </li>
      
      <li class="item item-toggle">
        Light 4
        <label class="toggle toggle-positive">
          <input type="checkbox" id="device4" data-device="4">
          <div class="track">
            <div class="handle">
            </div>
          </div>
        </label>
      </li>
      
      <li class="item">
        Blinds 1
		<div class="buttongroup">
			<button class="button button-positive">
				Up
			</button>
			<button class="button button-positive">
				Down
			</button>
		</div>
      </li>
      
      <li class="item">
        Blinds 2
		<div class="buttongroup">
			<button class="button button-positive">
				Up
			</button>
			<button class="button button-positive">
				Down
			</button>
		</div>
      </li>
      
      <li class="item item-toggle">
        Automatic
        <label class="toggle toggle-positive">
          <input type="checkbox" id="auto" data-device="auto">
          <div class="track">
            <div class="handle">
            </div>
          </div>
        </label>
      </li>
	 
	</ul>
  </div>
  </div>
  <div class="ct bar bar-footer bar-positive">
    <div id="ftr" class="title">
    </div>
  </div>
  

</body>


</html>

